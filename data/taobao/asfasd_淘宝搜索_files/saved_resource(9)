/*! umpp 2015-08-03 */
KISSY.add("tbc/umpp/1.5.4/mods/messenger",function(a,b,c,d){function e(a,b){return u.push([a,b])-1}function f(a){return u[a]=null}function g(c,e,f){var g={type:c,content:e},h=f;if(a.isString(f)?(h=b.get("#"+f),f=h.contentWindow):f.contentWindow&&(f=f.contentWindow),l())try{return f.KISSY.TBC.Messenger.fire(c,e)}catch(i){}p?m&&(m.callSWF?m.callSWF("send",[g,k(h)]):m.send(g,k(h))):f.postMessage(d.stringify(g),"*")}function h(b,c){a.each(u,function(a){a&&a[0]===b&&a[1](c)})}function i(c,d){var e,f=(p?"parentFlash="+x+"&childFlash=_MessengerChildFlash_"+a.now()+"&":"")+"domain=taobao.org";a.isString(c)?(e=c,c={}):e=c.src,c.src=e+(e.indexOf("?")>-1?"&":"?")+f;var g=b.create("<iframe>",c);return g.setAttribute("width",1),g.setAttribute("height",1),g.style.position="absolute",b.get(d||"body").appendChild(g)}function j(a,b){v?i(a,b):w.push([a,b])}function k(a){var b=a.src,c=/childFlash=([^&]+)/;if(b){var d=b.match(c);if(d&&d[1])return d[1];throw"iframe has no flashName param"}}function l(){return!1}var m,n=window,o=a.namespace("KISSY.TBC.Messenger",parseFloat(a.version)<6?!0:window),p=(document.domain,"undefined"==typeof postMessage||!n.addEventListener),q=-1===location.host.indexOf("daily")&&-1===location.host.indexOf("net"),r="//"+(q?"g.alicdn.com":"assets.daily.taobao.net/g"),s="1.5.4",t=parseFloat(s)?r+"/tbc/umpp/"+s+"/flash-post-message.swf":"flash-post-message.swf",u=[],v=!p,w=[],x="_MessengerFlash_"+a.now();if(!l()||p)if(p){var y=parseFloat(a.version),z=6>y,A=!(1.2>=y||y>=1.4)||!z;a.use(A?z?"swf":"kg/swf/0.0.1/index":"flash",function(a,b){window._Messenger_Flash_PostMessage=function(a,b){var c=b.type,d=b.msg;if("swfReady"===c){v=!0;for(var e;e=w.pop();)i.apply(null,e)}else"message"==c&&d&&h(d.type,d.content)};var c={src:t,attrs:{width:1,height:1,style:"position:absolute;top:0",id:"umpp-message-id",name:"umpp-message-name"},params:{flashVars:{jsentry:"_Messenger_Flash_PostMessage",swfid:"J_MessengerFlashPostMessage",name:x},allowscriptaccess:"always"}};b&&A?m=new b(c):a.Flash&&a.Flash.add&&a.Flash.add("#J_FlashPostMessageContainer",c,function(a){m=a.swf})})}else n.addEventListener("message",function(b){var c=b.data;if(c&&a.isString(c))try{var e=d.parse(c);h(e.type,e.content)}catch(f){}},!1);else v=!0;return a.mix(o,{register:e,unregister:f,send:g,createIframe:j,fire:h,flashName:x})},{requires:["dom","event","json"]}),KISSY.add("tbc/umpp/1.5.4/mods/getNick",function(a,b){var c=a.namespace("KISSY.TBC.umpp",parseFloat(a.version)<6?!0:window);return c.getNick=function(a){var c=b.get("_nk_")||b.get("lgc");return a&&c?encodeURIComponent(unescape(c.replace(/\\u/g,"%u"))):c}},{requires:["cookie"]}),KISSY.add("tbc/umpp/1.5.4/mods/trinity",function(a,b){function c(a,b,c){this.nick=a||"umpp-guest",this.swfurl=b,this.evs=c,this._init()}var d=a.namespace("KISSY.TBC.umpp",parseFloat(a.version)<6?!0:window),e="UM_",f=window,g="J_UmppUserContainer",h="_umpp_trinity_",i=c.prototype;return i._init=function(){var c=this,d={src:c.swfurl,attrs:{width:1,height:1,id:"umpp-trinity-id",name:"umpp-trinity-name"},params:{flashVars:{jsentry:h,swfid:e+c.nick+a.now(),group:c.nick},allowscriptaccess:"always"}};f[h]=function(a,b){var d=b.type,e=b.data,f=c.evs,g=f[d];g&&g.call(c,"message"===d?e:null)};var i=parseFloat(a.version),j=6>i,k=!(1.2>=i||i>=1.4)||!j;a.use(k?j?"swf":"kg/swf/0.0.1/index":"flash",function(a,e){k&&e?c.swf=new e(d):a.Flash&&a.Flash.add&&(b.get("#"+g)||document.body.appendChild(b.create('<div id="'+g+'" style="height:1px;width:1px;overflow:hidden;position:absolute;bottom:1px"></div>')),a.Flash.add("#"+g,d,function(a){c.swf=a.swf}))})},i.fire=function(a,b){return this.swf.callSWF?this.swf.callSWF("fire",[a,b]):(this.swf.fire(a,b),void 0)},i.destroy=function(){var a=this;try{a.swf.destroy?a.swf.destroy():b.remove("#"+g),delete f[h]}catch(c){}},d.Trinity=c},{requires:["dom"]}),KISSY.add("tbc/umpp/1.5.4/mods/initGuest",function(a){function b(b,f,g){return e._guestTimer=setTimeout(function(){a.getScript(parseFloat(c)?f+"/tbc/umpp/"+c+"/guest-min.js":"guest.js",function(){parseFloat(a.version,10)>1.1&&a.use(parseFloat(c)?"tbc/umpp/"+c+"/guest":"tbc/umpp/guest")})},d),a.mix(e,{isOnline:b,cdnPath:f,Trinity:g}),e}var c="1.5.4",d=18e4,e=a.namespace("KISSY.TBC.umpp",parseFloat(a.version)<6?!0:window);return a.mix(e,{register:function(){},send:function(){},destroy:function(){this.trinity&&(this.trinity.destroy(),delete this.trinity),this._guestTimer&&(clearTimeout(this._guestTimer),this._guestTimer=null)}}),e.initGuest=b}),KISSY.add("tbc/umpp/1.5.4/mods/initUser",function(a,b,c,d){function e(b){var d=/onerror|onload|script|svg|eval|function/gi;if(a.isString(b))return b.replace(d,"_");if(a.isObject(b)){for(var e in b)a.isString(b[1])&&(b[e]=b[e].replace(d,"_"));return b}return a.isArray(b)?(b=c.stringify(b).replace(d,"_"),c.parse(b)):b}function f(a){b.get("#"+s)||r.createIframe({src:a,id:s,frameborder:0,scrolling:"no"})}function g(b){a.isArray(b)&&b.length&&a.each(b,function(a){"1063"==a.t1&&w.trinity.fire({content:[a],identity:[w.nick,a.t1,"1"].join("-")})})}function h(){r.register("umppready",function(){p=!0,j("master"),j("join")}),r.register("umppdata",function(b){if(a.isArray(b))for(var c=b.length,d=0;c>d;d++){var e=b[d];e.content&&a.isString(e.content)&&(e.content=e.content.replace(/"/g,x))}w.notify(b,!0),g(b)})}function i(b,d){if(!d)return!1;a.isString(d)&&(d=c.parse(decodeURI(d)));var e=d.body,f=e.content;if(a.isObject(e))if("-"===e.identity)a.each(f,function(b){a.each(w._Events,function(c){c&&b.t1==c[0]&&(b.content&&a.isString(b.content)&&(b.content=b.content.replace(new RegExp(x,"g"),'"')),c[1](b))})});else if(t===e.type)if(n){var g=f[0],h=f[1];"umpp-store-get"===g?w.getItem(h,function(a){b.fire.call(b,{type:t,content:[h,a]},d.from)}):"umpp-store-remove"===g?w.removeItem.call(w,h):"umpp-store-set"===g?w.setItem.apply(w,h):w.send(g,h)}else{var f=e.content;r.fire("umpp-store-get-"+f[0],f[1])}else if(u===e.type){if(!e.includeSelf&&d.from===d.to)return!1;j("message",e.content)}}function j(b,c){a.each(w._SwfEvents,function(a){a&&b===a[0]&&(a[1](c),"message"!==b&&(a[0]=b+"_ed"))})}function k(a){f("//mpp."+(a?"taobao.com":"daily.taobao.net")+"/ajaxconn2.html?appId="+v),p&&j("master")}function l(a,b,c,e){w.trinity=new a(b,c,{master:function(){n=!0,h(),new d({url:location.protocol+"//allot-mpp."+(e?"taobao.com":"daily.taobao.net")+"/allot.do?appId="+v,dataType:"jsonp",timeout:3,success:function(a){if(a&&0==a.code){var b=a.tn?a[a.tn]:a.token;b&&(b="&"+(a.tn?a.tn:"token")+"="+b),f("//"+a.host+"/ajaxconn2.html?appId="+v+b),p&&j("master")}else a&&1111==a.status&&k(e)},error:function(){k(e)}})},join:function(){o=!0,(n&&p||!n)&&j("join")},message:function(a){i(this,a)}})}function m(a,b,c,d,e){var f=parseFloat(q)?b+"/tbc/umpp/1.4.35/trinity.swf":"trinity.swf";return w.nick=c,l(d,c,f,a),w.on("join",function(){new e({mc:w})}),w}var n,o,p,q="1.5.4",r=a.TBC.Messenger,s="J_Um_Iframe",t="_trinity_notify_private",u="_trinity_notify_public",v=-1===location.host.indexOf("meeting.wangwang")?1064:1065,w=a.namespace("KISSY.TBC.umpp",parseFloat(a.version)<6?!0:window),x="@1fuck1@";return a.mix(w,{_Events:[],_SwfEvents:[],_StoreCache:{},_storeData:function(a,b){n&&(this._StoreCache[a]=b)},_removeData:function(a){n&&this._StoreCache[a]&&delete this._StoreCache[a]},on:function(a,b){return(n&&p||!n&&o)&&("master"===a&&n||"join"===a&&o)?(b(),!0):this._SwfEvents.push([a,b])-1},off:function(b){return a.isNumber(b)?this._SwfEvents[b]=null:void 0},register:function(a,b,c){var d=this,f=function(f,g){f&&(f=e(f)),b(f,g),c?d._storeData(a,f):d.removeItem(a)};return d.getItem(a,function(a){a&&f(a,!0)}),d._Events.push([a,f])-1},unregister:function(a){return this._Events[a]=null},send:function(a,b){return n?r.send.call(null,a,b,s):(this.trinity&&this.trinity.fire({type:t,content:[a,b]},"_"+this.nick),void 0)},notify:function(a,b){return this.trinity.fire({type:u,content:a,includeSelf:b,identity:"-"})},setItem:function(a,b){var c=this;c.on("join",function(){c._storeData(a,b),c.send("umpp-store-set",[a,b])})},getItem:function(a,b){var c=this,d=this._StoreCache[a];n&&d?b(d):c.on("join",function(){var d=r.register("umpp-store-get-"+a,function(e){r.unregister(d),c._storeData(a,e),b(e)});c.send("umpp-store-get",a)})},removeItem:function(a){var b=this;b.on("join",function(){b._removeData(a),b.send("umpp-store-remove",a)})},clear:function(a){return this.send("clearTMsg",a)},destroy:function(){this.trinity&&(this.trinity.destroy(),delete this.trinity),b.remove("#"+s),n=void 0,o=void 0,p=void 0,this._StoreCache={}}}),w.initUser=m},{requires:["dom","json","ajax"]}),KISSY.add("tbc/umpp/1.5.4/mods/monitorevent",function(a,b){function c(b){this.cfg=a.merge({delay:2e4},b||{}),this.status=1,this._init()}return a.mix(c.prototype,{get:function(a){return this.cfg[a]},set:function(a,b){this.cfg[a]=b},_init:function(){var b=window.g_config;return b?!b.appId||1!=b.appId&&1009!=b.appId?!1:(this.itemId=b.itemId,this.itemId?(this.activeTime=a.now(),this.cfg.mc.send("umpp-monitor-event",[this.itemId,1,this.activeTime].join(",")),this.timer=null,this._bindEvent(),this._addTimer(),this._registerUmppEvent(),void 0):!1):!1},_bindEvent:function(){var a=this;b.on(window,"focus",function(){a._active.call(a),a._focus.call(a)}),b.on(window,"blur",function(){a._active.call(a),a._blur.call(a,!0)}),b.on(window,"mousemove scroll",function(){a._active.call(a)}),b.on(window,"beforeunload",function(){a._close.call(this)})},_registerUmppEvent:function(){var a=this,b=a.cfg.mc;b.register("monitor-start",function(){a.start.call(a)}),b.register("monitor-focustime",function(b){a.set.call(a,"delay",1e3*b.focustime)})},_focus:function(){this.set("focusbluring",!1),this.status&&(this._removeTimer(),this.timer||this._addTimer(),this.cfg.mc.send("umpp-monitor-event",[this.itemId,2,a.now()].join(",")))},_blur:function(b){this.set("focusbluring",!1),this.status&&(b&&this._removeTimer(),this.cfg.mc.send("umpp-monitor-event",[this.itemId,3,a.now()].join(",")))},_active:function(){this.activeTime=a.now()},_close:function(){this.status&&this.cfg.mc.send("umpp-monitor-event",[this.itemId,4,a.now()].join(","))},_addTimer:function(){var b=this;b.timer=setTimeout(function(){var c=a.now();c-b.activeTime>b.cfg.delay&&!b.get("focusbluring")&&(b._blur(),b.set("focusbluring",!0)),b.timer=setTimeout(arguments.callee,b.cfg.delay)},b.cfg.delay)},_removeTimer:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}}),c},{requires:["event"]}),KISSY.add("tbc/umpp/1.5.4/index",function(a,b,c,d,e,f,g,h){function i(){var c,d=-1===location.host.indexOf("daily"),e=b.get("_l_g_")||b.get("lgc"),f=location.protocol+"//"+(d?"g.alicdn.com":"assets.daily.taobao.net/g"),g=j._Events,i=j._SwfEvents;return c=e?j.initUser(d,f,j.getNick(!0),j.Trinity,h):j.initGuest(d,f,j.Trinity),g&&a.mix(c,{_Events:g}),i&&a.mix(c,{_SwfEvents:i}),a.mix(j,c)}a.version>=1.4&&a.config({modules:{ajax:{alias:["io"]},flash:{alias:["gallery/flash/1.0/"]}}});var j=a.namespace("KISSY.TBC.umpp",parseFloat(a.version)<6?!0:window);return j.init=i,i()},{requires:["cookie","tbc/umpp/1.5.4/mods/messenger","tbc/umpp/1.5.4/mods/getNick","tbc/umpp/1.5.4/mods/trinity","tbc/umpp/1.5.4/mods/initGuest","tbc/umpp/1.5.4/mods/initUser","tbc/umpp/1.5.4/mods/monitorevent"]});/*! tmsg 2015-10-20 */
KISSY.add("tbc/tmsg/3.4.6/mods/const",function(a){var b=a.namespace("TMsg",parseFloat(a.version)<6?!0:window);a.mix(b,{apis:{token:location.protocol+"//dianping.{serverHost}/json/token.htm",hoverCount:location.protocol+"//msg.{serverHost}/json/hover_count.htm",unreadMessage:location.protocol+"//msg.{serverHost}/json/hover_message.htm",ignore:location.protocol+"//msg.{serverHost}/json/hover_ignore.htm",buyerHistory:location.protocol+"//msg.{serverHost}/json/history_msg_tag.htm?userType=1",sellerHistory:location.protocol+"//msg.{serverHost}/json/history_msg_tag.htm?userType=2",buyerHistoryList:location.protocol+"//msg.{serverHost}/json/history_message_list.htm?userType=1",sellerHistoryList:location.protocol+"//msg.{serverHost}/json/history_message_list.htm?userType=2",message_list_for_hover:location.protocol+"//msg.{serverHost}/json/message_list_for_hover.htm",buyerSettingList:location.protocol+"//msg.{serverHost}/json/show_msg_setting.htm?source=1",sellerSettingList:location.protocol+"//msg.{serverHost}/json/show_msg_setting.htm?source=3",SettingSet:location.protocol+"//msg.{serverHost}/json/msg_setting.htm",popupMessage:location.protocol+"//msg.{serverHost}/json/popup_msg_list.htm",popupMessageReaden:location.protocol+"//msg.{serverHost}/json/read_popup_msg.htm",appReaden:location.protocol+"//msg.{serverHost}/json/message_read.htm",popupReaden:location.protocol+"//msg.{serverHost}/json/read_popup_msg.htm",deleteMessage:location.protocol+"//msg.{serverHost}/message/delete_system_message.htm"}}),a.mix(b,{temps:{panel:{foot:'<div class="J_Tmsg_Panel_Foot tmsg_panel_foot">   <a class="J_Tmsg_Button_Setting tmsg_button_setting" data-tips="setting" title="\u6d88\u606f\u8bbe\u7f6e" href="#">\u8bbe\u7f6e</a>   <a class="J_Tmsg_Button_Feedback tmsg_button_feedback" data-tips="feedback" title="\u610f\u89c1\u53cd\u9988" href="//ur.taobao.com/survey/view.htm?spm=1.6659421.0.0.Nmaw77&id=1990&scm=1229.325.1.1" target="_blank">\u53cd\u9988</a>   <span class="J_Tmsg_Button_CheckAll_Wrap tmsg_button_check-all_wrap">       <a class="J_Tmsg_Button_CheckAll tmsg_button_check-all" href="#" target="_blank">\u67e5\u770b\u5168\u90e8</a>   </span></div>',apps:{apps_head:'<div class="J_Tmsg_Panel_Head tmsg_panel_head">   <h2 class="J_Tmsg_Panel_Title tmsg_panel_title">\u672a\u8bfb\u65b0\u6d88\u606f</h2>   <a class="J_Tmsg_Button_ReadAll tmsg_button_read-all" data-tip="ignoreAll" title="\u5ffd\u7565\u6240\u6709\u6d88\u606f" href="#">\u5168\u90e8\u8bbe\u4e3a\u5df2\u8bfb</a></div>',apps_head2:'<div class="J_Tmsg_Panel_Head tmsg_panel_head">   <h2 class="J_Tmsg_Panel_Title tmsg_panel_title">{title}</h2>   <a class="J_Tmsg_Button_GoBack tmsg_button_go-back" data-tips="read_all" href="#">\u8fd4\u56de</a></div>',apps_body:'<div class="J_Tmsg_Panel_AppsBody tmsg_panel_body">   <img style="display:block;margin:30px auto" width="48" height="48" src="//gtd.alicdn.com/tps/i4/T1HcvHXd4nXXb6ROYh-48-48.gif" /></div>',apps_item:'<div class="J_Tmsg_App tmsg_app {shopClass}" data-app-id="{appId}" data-app-type="{appType}">   <h3 class="tmsg_app_title">       <em class="tmsg_app_title_app-name">{mainTitle}</em>       <span class="tmsg_app_title_new-info">{subTitle}</span>   </h3>   <ul class="tmsg_app_list {single}">{subList}</ul>   <a class="J_Tmsg_Button_CloseApp tmsg_button_close-app" title="\u5ffd\u7565\u8be5\u6d88\u606f" href="#">\u5173\u95ed</a>   {moreIcon}   {extraButton}</div>',apps_item_single:'<div class="J_Tmsg_App tmsg_app {shopClass}" data-app-id="{appId}" data-message-id="{messageId}">   <h3 class="tmsg_app_title">       <em class="tmsg_app_title_app-name">{mainTitle}</em>       <span class="tmsg_app_title_new-info">{subTitle}</span>   </h3>   <ul class="tmsg_app_list tmsg_app_list_single">       <li class="tmsg_details_item">           <a class="tmsg_details_item_thumb" href="{link}" target="_blank">               <img src="{pic}" width="60" height="60" alt=""/>               {tips}           </a>           <h4 class="tmsg_details_item_title">               <a href="{link}" target="_blank">{title}</a>           </h4>           <p class="tmsg_details_item_info">               <a href="{link}" target="_blank">{info}</a>           </p>           <a class="tmsg_link" href="{actionUrl}" target="_blank">{actionName}</a>       </li>   </ul><span class="J_Tmsg_App_Remove tmsg_app_btn_remove" title="\u5220\u9664\u8fd9\u6761\u6d88\u606f">\u5220\u9664</span></div>',apps_item_subItem:'<li class="tmsg_app_list_item">   <a class="{klass}" href="{link}" {target}>       <img class="tmsg_app_list_item_thumb" width="60" height="60" src="{thumb}" alt="" />   </a>   {tips}   {roundMask}   {tipsFixIeNumber}</li>',apps_item_subItem_single:'<li class="tmsg_details_item">   <a class="J_Tmsg_Apps_Single-Item_Link tmsg_details_item_thumb" href="{link}" target="_blank">       <img src="{pic}" width="60" height="60" alt=""/>       {tips}   </a>   <h4 class="tmsg_details_item_title">       <a class="J_Tmsg_Apps_Single-Item_Link" href="{link}" target="_blank">{title}</a>   </h4>   <p class="tmsg_details_item_info">       <a class="J_Tmsg_Apps_Single-Item_Link" href="{link}" target="_blank">{info}</a>   </p>   <a class="J_Tmsg_Apps_Single-Item_Link tmsg_link" href="{actionUrl}" target="_blank">{actionName}</a></li>',apps_item_tips:'<p class="tmsg_app_list_item_tip"><span>{tips}</span><i></i></p>',apps_item_roundMask:'<p class="tmsg_app_list_item_tip_fixie-mask"></p>',apps_item_tips_fixIeNumber:'<span class="tmsg_app_list_item_tip_fixie-num"><span>{num}</span><i></i></span>',apps_item_icon_more:'<a class="tmsg_button_more" href="#">\u66f4\u591a</a>',apps_item_button_deploy:'<a class="J_Tmsg_Button_DeployApp tmsg_button_deploy-app" href="#">\u5c55\u5f00</a>',apps_item_button_linkout:'<a class="J_Tmsg_Button_LinkoutToAPP tmsg_button_linkout-to-app" href="{link}" target="_blank">\u67e5\u770b</a>'},errors:{no_message_with_history:'<div class="tmsg_error">   <p class="tmsg_error_notice">       <img width="23" height="14" src="//gtms02.alicdn.com/tps/i2/T1KLt9FuVaXXXIaF_b-23-14.png" alt=""/>       <span>\u6ca1\u6709\u65b0\u6d88\u606f\u4e86</span>       <img width="23" height="14" src="//gtms01.alicdn.com/tps/i1/T1xwX6FshtXXXIaF_b-23-14.png" alt=""/>   </p>   <div class="tmsg_error_pic tmsg_error_pic_type1"></div>   <a class="J_Tmsg_Button_CheckPrevMsgs tmsg_button_check-prev-msgs" href="#">\u67e5\u770b\u4e4b\u524d\u7684\u6d88\u606f</a></div>',no_message_without_history:'<div class="tmsg_error">   <p class="tmsg_error_notice">       <img width="23" height="14" src="//gtms02.alicdn.com/tps/i2/T1KLt9FuVaXXXIaF_b-23-14.png" alt=""/>       <span>\u6ca1\u6709\u65b0\u6d88\u606f\u4e86</span>       <img width="23" height="14" src="//gtms01.alicdn.com/tps/i1/T1xwX6FshtXXXIaF_b-23-14.png" alt=""/>   </p>   <div class="tmsg_error_pic tmsg_error_pic_type1"></div></div>',no_message_when_setting:'<div class="tmsg_error">   <p class="tmsg_error_notice">       <img width="23" height="14" src="//gtms02.alicdn.com/tps/i2/T1KLt9FuVaXXXIaF_b-23-14.png" alt=""/>       <span>\u4f60\u8fd8\u6ca1\u6709\u6536\u5230\u8fc7\u6d88\u606f\u54e6\uff0c\u7b49\u6536\u5230\u4e86\u518d\u6765\u8bbe\u7f6e\u5427\u3002</span>       <img width="23" height="14" src="//gtms01.alicdn.com/tps/i1/T1xwX6FshtXXXIaF_b-23-14.png" alt=""/>   </p>   <div class="tmsg_error_pic tmsg_error_pic_type2"></div></div>',network_anomaly:'<div class="tmsg_error">   <p class="tmsg_error_notice">       <img width="23" height="14" src="//gtms02.alicdn.com/tps/i2/T1KLt9FuVaXXXIaF_b-23-14.png" alt=""/>       <span>\u7f51\u7edc\u5f02\u5e38\uff0c<a class="J_Tmsg_Button_Refresh tmsg_button_refresh" href="#">\u5237\u65b0</a>\u4e00\u4e0b</span>       <img width="23" height="14" src="//gtms01.alicdn.com/tps/i1/T1xwX6FshtXXXIaF_b-23-14.png" alt=""/>   </p>   <div class="tmsg_error_pic tmsg_error_pic_loading"></div></div>'}},details:{typeWrap:'<h3 class="tmsg_app_title">   <em class="tmsg_app_title_app-name">{typeTitle}</em></h3><ul class="tmsg_details_auction-list">{list}</ul>',singleWrap:'<ul class="tmsg_details_logistics-list">{list}</ul>',itemTemp:'<li class="tmsg_details_item">   <a class="tmsg_details_item_thumb" href="{link}" target="_blank">       <img src="{pic}" width="60" height="60" alt=""/>       {tips}   </a>   <h4 class="tmsg_details_item_title">{title}</h4>   <p class="tmsg_details_item_info_logistics-status">{info}</p>   <a class="tmsg_link" href="{link}" target="_blank">{actionName}</a></li>'},setting:{wrap:'<h3 class="tmsg_app_title">   <em class="tmsg_app_title_app-name">{title}</em></h3><ul class="tmsg_app_settilg-list">{list}</ul>',list:'<li class="J_Tmsg_App_Setting_Item tmsg_app_settilg-item" data-app-id="{appId}">   <em class="tmsg_app_settilg-item_name">{appName}</em>   <span class="tmsg_app_settilg-item_edit tmsg_app_settilg-item_status_{status}" data-status="{statusNum}">       <a class="J_Tmsg_Setting_App_Edit_Button tmsg_app_settilg-item_button-edit" href="#">\u8bbe\u7f6e</a>   </span></li>'},strong:{wrap:'<div class="J_Tmsg_Panel_StrongPop tmsg_panel_strong_popup">   <div class="tmsg_panel_strong_list">{list}</div>   <div class="J_Tmsg_Panel_Strong_Button tmsg_panel_strong_button">       <a class="J_Tmsg_Panel_Strong_Button_Prev tmsg_panel_strong_button_prev " href="#">\u4e0a\u4e00\u4e2a</a>       <a class="J_Tmsg_Panel_Strong_Button_Next tmsg_panel_strong_button_next" href="#">\u4e0b\u4e00\u4e2a</a>   </div></div>',item:'<div class="tmsg_panel_strong_item" data-message-id="{appId}" data-app-type="{appType}">   <h3 class="tmsg_app_title">       <em class="tmsg_app_title_app-name">{mainTitle}</em>       <span class="tmsg_app_title_new-info">{subTitle}</span>   </h3>   <ul class="tmsg_app_list tmsg_app_list_single">       <li class="tmsg_details_item">           <a class="J_Tmsg_Strong_Item_Read tmsg_details_item_thumb" href="{link}" target="_blank">               <img src="{pic}" width="60" height="60" alt="">               {tips}           </a>           <h4 class="tmsg_details_item_title">               <a class="J_Tmsg_Strong_Item_Read" href="{link}" target="_blank">{title}</a>           </h4>           <p class="tmsg_details_item_info_logistics-status">               <a href="{link}" target="_blank">{info}</a>           </p>           <a class="J_Tmsg_Strong_Item_Read tmsg_link" href="{link}" target="_blank">{actionName}</a>       </li>   </ul>   <a class="J_Tmsg_Popup_Button_CloseApp tmsg_button_close-app" href="#">\u5173\u95ed</a></div>'}}})}),KISSY.add("tbc/tmsg/3.4.6/mods/utils",function(a,b,c,d,e){var f=TMsg,g=window,h=!~location.host.indexOf("daily.taobao.net"),i="tbc/tmsg/3.4.6/plugin/";a.mix(f,{event:{},plugin:{}}),a.mix(f,{isIE6:g.ActiveXObject&&!g.XMLHttpRequest,isKS16:!(parseFloat(a.version,10)>1.1),isDebug:!!~location.search.indexOf("ks-debug"),isOnline:h,cdnHost:h?location.protocol+"//g.alicdn.com/":location.protocol+"//assets.daily.taobao.net/g/",serverHost:h?"taobao.com":"daily.taobao.net",environment:TB.Global&&TB.Global.version>=2?"New Global":TB.SellerGlobal?"Seller Global":"Old Global"}),a.mix(f,{sm:{init:function(){window.UA_Opt&&window.ua||(window.UA_Opt=window.UA_Opt||{LogVal:"ua",MaxMCLog:3,MaxMPLog:3,MaxKSLog:3,Token:(new Date).getTime()+":"+Math.random(),SendMethod:8,Flag:14222},window.ua="",a.getScript(location.protocol+"//acjs.aliyun.com/actionlog/js/ua.js",function(){try{UA_Opt.reload()}catch(a){}},"GBK"))},ua:function(){var b=window.ua;return UA_Opt.Token=a.now()+":"+Math.random(),UA_Opt.reload(),b}},use:function(b,c){var d=[b],e=b+"-min.js";a.getScript(f.cdnHost+i+e,function(){f.isKS16?c&&c():a.use(i+d.join(","+i),function(){c&&c()})})},ajax:function(b,c,e){var f={t:a.now(),_input_charset:"utf-8"};d.jsonp(b,a.merge(f,c),function(a){e&&e(a)})},deal:function(a,c){if("string"==typeof a&&(a=e.parse(a)),a.status==c.success.code)c.success.callback&&c.success.callback(a);else if(a.status==c.noLogin.code)c.noLogin.callback?c.noLogin.callback(a):f.error.noLogin();else if("0"==a.status){var d=b.get(".J_Tmsg_Panel_AppsBody");b.html(d,f.temps.panel.errors.network_anomaly)}else if("delErr"==a.status){var d=b.get(".J_Tmsg_Panel_AppsBody");b.html(d,f.temps.panel.errors.network_anomaly),c.delErr.callback&&c.delErr.callback(a)}else c.error.callback&&c.error.callback(a)},getNick:function(){return f.fromUnicode(a.Cookie.get("_nk_"))},setToken:function(){if(f.token)return!1;var a=location.protocol+"//dianping."+f.serverHost+"/json/token.htm";d.jsonp(a,{_fetchToken:!0},function(a){f.token=a.token})},getToken:function(b){f.token?b&&b(f.token):d.jsonp(f.renderUrl(f.apis.token),{_fetchToken:!0},function(c){a.mix(f,{token:c.token}),b&&b(c.token)})},fromUnicode:function(a){return a.replace(/\\u([a-f\d]{4})/gi,function(a,b){return String.fromCharCode(parseInt(b,16))})},sendStatistic:function(b){b&&((new Image).src=location.protocol+"//gm.mmstat.com/sns."+b+"?cache="+a.now())},switchGlobal:function(a){switch(f.environment){case"Seller Global":a.seller&&a.seller();break;default:a.common&&a.common()}},renderUrl:function(b){return a.substitute(b,{serverHost:f.serverHost})},getStrLength:function(a){for(var b=a.length,c=0,d=0;b>d;d++)a.charCodeAt(d)<27||a.charCodeAt(d)>126?c+=2:c++;return c},substringWithinLimit:function(a,b){if(!a||!b)return"";for(var c=0,d=0,e="",f="...";d<a.length;d++){if(a.charCodeAt(d)>255?c+=2:c++,c>b)return e+f;e+=a.charAt(d)}return a+f},setScroll:function(){},delArrayItem:function(a,b){return 0>b?a:a.slice(0,b).concat(a.slice(b+1,a.length))}})},{requires:["dom","event","ajax","json"]}),KISSY.add("tbc/tmsg/3.4.6/mods/tmsg",function(a,b,c,d,e){var f,g,h,i,j=TMsg,k=(j.apis,j.temps),l=a.TBC.umpp,m="3.4.4",n={},o=!1,p=!1,q=!1,r=!(!j.isKS16&&!j.isIE6);return j.error=j.error||{},j.error.noLogin=j.error.noLogin||function(){var a=b.get(".J_Tmsg_Panel_Apps");j.base.setMessageCenterLink(a);var c=b.get(".J_Tmsg_Panel_AppsBody"),d=b.get(".J_Tmsg_Panel_Head"),e=b.get(".J_Tmsg_Button_Setting"),f=b.get(".J_Tmsg_Button_Feedback");b.hide(c),b.hide(d),b.hide(e),b.hide(f)},j.base={dataFormatting:function(b){return a.isString(b)?c.parse(b):a.isObject(b)&&b.content?a.isString(b.content)?c.parse(b.content):a.isObject(b.content)?b.content:void 0:b},registUmpp:function(){var b,c,d=this,e=2,f="tmsgexpiretime",i=setTimeout(function(){i&&(clearTimeout(i),i=null),d.renderHeadNum("timeout")},5e3);h=l.register("1067",function(e,g){i&&(clearTimeout(i),i=null),c=d.dataFormatting(e),q=!1,l.setItem("1067",a.merge(n,c.content?c.content:c)),!g&&j.sendStatistic("21.50"),n=a.merge(n,c),d.renderHeadNum(c),b&&!g&&l.setItem(f,a.now())},!0),g=l.on("master",function(){b=!0,l.getItem(f,function(b){(!b||a.now()-1*b>=60*e*60*1e3)&&(l.setItem("1067",{}),d.fetchMsg())})})},fetchMsg:function(){var b=this,c=j.renderUrl(j.apis.hoverCount);j.ajax(c,{},function(c){j.deal(c,{noLogin:{code:"-1"},success:{code:"1",callback:function(c){n=a.merge(n,c.content),l.setItem("1067",n),l.notify([{t1:"1067",content:n}],!0),b.renderHeadNum(n)}}})})},cpg:function(){function a(a){l&&l.getItem(a,function(b){b&&(l.removeItem(a),window.console&&window.console.debug&&console.debug("\u6e05\u7406\u672c\u5730\u7f13\u5b58["+a+"]\u5b8c\u6bd5\uff01"))})}var b="1067_cpg";l&&l.getItem(b,function(a){var c=["(\u3000\xb4\u2200\uff40)","(\uff9f\uff70\uff9f)","(*\uff40\u25bd\xb4*)","( \uff9f\u0414\uff9f)","\uff08\uff3e\uff10\uff3e\uff09"],d=Math.floor(5*Math.random());a||(l.setItem("tmsgexpiretime",0),l.setItem("1067",{})),l.setItem(b,c[d])}),a("20141212")},init:function(){var a=this;if(!r&&a.renderHoverBase(),a.registUmpp(),a.cpg(),r){var c=b.get(".J_Menu","#J_Tmsg");b.remove(".menu-bd","#J_Tmsg"),b.remove(".tmsg_basic_arrow","#J_Tmsg"),d.on(c,"click",function(a){j.switchGlobal({common:function(){location.href=j.renderUrl("//msg.{serverHost}/message/list.htm")},seller:function(){location.href=j.renderUrl("//msg.{serverHost}/seller/seller_list.htm")}})})}else d.delegate("#J_Tmsg","mouseenter",".J_Menu",function(a){j.sendStatistic("21.1")}),j.switchGlobal({common:function(){},seller:function(){d.on(".J_Tmsg_Basic","mouseenter",function(b){!r&&a.renderHover()})}})},destroy:function(){!!n&&(n={}),l.unregister(h),l.off(g)},renderHoverBase:function(){var a=b.get(".J_Tmsg_Panel_Apps"),c=b.create(k.panel.apps.apps_head),d=b.create(k.panel.apps.apps_body),e=b.create(k.panel.foot);b.append(c,a),b.append(d,a),b.append(e,a)},resetLocalData:function(b,c){if(a.isArray(b))n.apps=[],n.buyerCount=0,n.sellerCount=0,l.setItem("1067",n),l.notify([{t1:"1067",content:n}],!0);else{var d=0;for(1==c?n.buyerCount-=1:(n.buyerCount-=1,n.sellerCount-=1);d<n.apps.length;d++)n.apps[d].appId==b&&(n.apps=j.delArrayItem(n.apps,d));n.buyerCount<0&&(n.buyerCount=0),n.sellerCount<0&&(n.sellerCount=0),l.setItem("1067",n),l.notify([{t1:"1067",content:n}],!0)}},renderHeadNum:function(a){var c=this,d=b.get("#J_Tmsg"),e=b.get(".J_Tmsg_Logo",d),f=b.get(".J_Tmsg_Logo_Loading",d),g=b.get(".J_Tmsg_Logo_Icon",d),h=b.get(".J_Tmsg_Logo_Unread",d);b.hide(f),b.show(g),"timeout"!==a?(a.buyerCount>0?j.switchGlobal({common:function(){b.addClass(e,"tmsg_logo_active"),b.html(h,a.buyerCount)},seller:function(){a.sellerCount>0&&(b.addClass(e,"tmsg_logo_active"),b.html(h,a.sellerCount))}}):(b.removeClass(e,"tmsg_logo_active"),b.html(h,"")),a.popupCount>0&&c.renderPopup()):b.addClass(e,"tmsg_logo_active")},renderPopup:function(){var c=this,e=j.renderUrl(j.apis.popupMessage);o||(o=!0,j.ajax(e,{},function(e){j.deal(e,{noLogin:{code:"-1"},success:{code:"1",callback:function(e){if(e.msgList.length){var f=b.get("#J_Tmsg"),g=b.get(".J_Tmsg_Panel_Strong",f),h="";a.each(e.msgList,function(b){h+=a.substitute(k.strong.item,{link:b.actionUrl,pic:b.picUrl,tips:c.renderTips(b.tips),appId:b.messageId,typeId:b.typeId,mainTitle:b.mainTitle,subTitle:b.subTitle,title:c.getTitle(b.contentMsg),info:c.getInfo(b.contentMsg.info.content),actionName:b.contentMsg.actionName.content||""})});var i=b.create(a.substitute(k.strong.wrap,{list:h}));if(1==e.msgList.length){var j=b.get(".tmsg_panel_strong_item",i);b.remove(b.get(".J_Tmsg_Panel_Strong_Button",i)),b.addClass(j,"J_Tmsg_Panel_Strong_Item_Active")}else{var l=b.query(".tmsg_panel_strong_item",i);a.each(l,function(a){b.removeClass(j,"J_Tmsg_Panel_Strong_Item_Active"),b.hide(a)}),b.addClass(l[0],"J_Tmsg_Panel_Strong_Item_Active"),b.show(l[0])}b.append(i,g),c.toggleStrongPanel(),d.delegate(f,"click",".J_Tmsg_Popup_Button_CloseApp",function(a){a.preventDefault(),c.popupClose()}),d.delegate(f,"click",".J_Tmsg_Panel_Strong_Button_Prev",function(a){a.preventDefault(),c.popupPrev(a.target)}),d.delegate(f,"click",".J_Tmsg_Panel_Strong_Button_Next",function(a){a.preventDefault(),c.popupNext(a.target)}),d.delegate(f,"click",".J_Tmsg_Strong_Item_Read",function(a){c.popupReaded(b.parent(a.target,".tmsg_panel_strong_item"))})}}}})}))},renderHoverList:function(c){var d=this,e="",f=b.get(".J_Tmsg_Panel_Apps"),g=b.get(".J_Tmsg_Panel_AppsBody",f);q=!0,d.setMessageCenterLink(f),j.switchGlobal({common:function(){c.apps&&c.apps.length?(a.each(c.apps,function(b){e+=a.substitute(k.panel.apps.apps_item,{appId:b.appId,appType:b.messageType,shopClass:"",mainTitle:b.mainTitle,subTitle:b.subTitle,subList:d.renderAppSubList(b.msgList,b.actionUrl),single:1==b.msgList.length?"tmsg_app_list_single":"",moreIcon:d.getAppMoreIcon(b),extraButton:d.getAppExtraButton(b)})}),b.html(g,e),d.setPanelBody(f),b.show(b.get(".J_Tmsg_Button_ReadAll",f))):d.switchNoMessageTemp()},seller:function(){c.sellerCount>0&&c.apps&&c.apps.length?(a.each(c.apps,function(b){e+="Seller Global"==j.environment&&1==b.messageType?"":a.substitute(k.panel.apps.apps_item,{appId:b.appId,appType:b.messageType,shopClass:"",mainTitle:b.mainTitle,subTitle:b.subTitle,subList:d.renderAppSubList(b.msgList,b.actionUrl),single:1==b.msgList.length?"tmsg_app_list_single":"",moreIcon:d.getAppMoreIcon(b),extraButton:d.getAppExtraButton(b)})}),b.html(g,e),d.setPanelBody(f),b.show(b.get(".J_Tmsg_Button_ReadAll",f))):d.switchNoMessageTemp()}}),!p&&d.bindBaseEvent()},renderHover:function(){var b=this,c=j.renderUrl(j.apis.unreadMessage);r||q||(!n.apps&&n.buyerCount||n.newMsgTag?j.ajax(c,{},function(c){j.deal(c,{noLogin:{code:"-1"},success:{code:"1",callback:function(c){n=a.merge(n,c.content,{newMsgTag:!1}),l.setItem("1067",n),l.notify([{t1:"1067",content:n}],!0),b.renderHoverList(n)}}})}):b.renderHoverList(n))},renderAppSubList:function(b,c){var d=this,e="";if(b.length>1)for(var f=0;f<b.length;f++)e+=a.substitute(k.panel.apps.apps_item_subItem,{klass:c?"J_Tmsg_Button_LinkoutToAPP":"J_Tmsg_Button_DeployApp",thumb:b[f].picUrl,link:c||"#",tips:d.renderTips(b[f].tips),target:c?'target="_blank"':""});else e+=a.substitute(k.panel.apps.apps_item_subItem_single,{link:b[0].actionUrl,title:d.getTitle(b[0].contentMsg),pic:b[0].picUrl,tips:d.renderTips(b[0].tips),info:d.getInfo(b[0].contentMsg.info.content),actionUrl:b[0].actionUrl||"",actionName:b[0].contentMsg.actionName.content||""});return e},renderTips:function(b){return b?a.substitute(k.panel.apps.apps_item_tips,{tips:b}):""},renderDeployTypesItem:function(b){var c=this,d="";return a.each(b,function(b){d+=a.substitute(k.details.itemTemp,{link:b.actionUrl,pic:b.picUrl,tips:c.renderTips(b.tips),title:c.getTitle(b.contentMsg),info:c.getInfo(b.contentMsg.info.content),actionName:b.contentMsg.actionName.content||""})}),d},renderDeploysingle:function(c){var d=this,e=b.get("#J_Tmsg"),f=b.get(".J_Tmsg_Panel_Detail",e),g=b.get(".J_Tmsg_Panel_AppsBody",f);b.html(g,a.substitute(k.details.singleWrap,{list:d.renderDeployTypesItem(c.types[0].msgList)})),d.togglePanel(f)},renderDeployTypes:function(c){var d=this,e=b.get("#J_Tmsg"),f=b.get(".J_Tmsg_Panel_Detail",e),g=b.get(".J_Tmsg_Panel_AppsBody",f),h="";a.each(c.types,function(b){h+=a.substitute(k.details.typeWrap,{typeTitle:b.subTitle,list:d.renderDeployTypesItem(b.msgList)})}),b.html(g,h),d.togglePanel(f)},getInfo:function(a){return a?j.getStrLength(a)>28?j.substringWithinLimit(a,28):a:""},getTitle:function(a){var b=a.title.content,c=j.getStrLength(b);return 0==c?"":c>0&&28>=c?b:a.info.content?j.substringWithinLimit(b,28):58>=c?b:j.substringWithinLimit(b,58)},getAppMoreIcon:function(a){return a.gtThree?k.panel.apps.apps_item_icon_more:""},getAppExtraButton:function(b){return 1==b.msgList.length?"":b.actionUrl?a.substitute(k.panel.apps.apps_item_button_linkout,{link:b.actionUrl}):k.panel.apps.apps_item_button_deploy},setMessageCenterLink:function(a){var c=b.get(".J_Tmsg_Button_CheckAll",a);j.switchGlobal({common:function(){if(b.removeClass(c,"J_Tmsg_Button_CheckAll"),n.hasSellerMsg){var d=b.get(".J_Tmsg_Button_CheckAll_Wrap",a);b.html(d,'<a href="'+j.renderUrl("//msg.{serverHost}/message/list.htm?scm=1229.325.1.2")+'" target="_blank">\u4e70\u5bb6\u6d88\u606f</a><span style="margin:0 7px">|</span><a href="'+j.renderUrl("//msg.{serverHost}/seller/seller_list.htm?scm=1229.325.1.3")+'" target="_blank">\u5356\u5bb6\u6d88\u606f</a>')}else b.attr(c,"href",j.renderUrl("//msg.{serverHost}/message/list.htm?scm=1229.325.1.2"))},seller:function(){b.removeClass(c,"J_Tmsg_Button_CheckAll"),b.attr(c,"href",j.renderUrl("//msg.{serverHost}/seller/seller_list.htm?scm=1229.325.1.3"))}})},setNoMessageTemp:function(a){var c=this,d=b.get(".J_Tmsg_Panel_Apps"),e=b.create(k.panel.apps.apps_head),f=b.create(k.panel.apps.apps_body),g=b.create(k.panel.foot);b.html(d,""),b.append(e,d),b.append(f,d),b.append(g,d),c.setMessageCenterLink(d),j.ajax(a,{},function(a){j.deal(a,{noLogin:{code:"-1"},success:{code:"1",callback:function(a){var c=b.get(".J_Tmsg_Panel_Apps"),d=b.get(".J_Tmsg_Panel_AppsBody",c);"false"!=a.historyTag?b.html(d,k.panel.errors.no_message_with_history):b.html(d,k.panel.errors.no_message_without_history),b.hide(b.get(".J_Tmsg_Button_ReadAll",c))}}})})},switchNoMessageTemp:function(){var a=this;j.switchGlobal({common:function(){var b=j.renderUrl(j.apis.buyerHistory);a.setNoMessageTemp(b)},seller:function(){var b=j.renderUrl(j.apis.sellerHistory);a.setNoMessageTemp(b)}})},setHistoryMessage:function(c){var d=this,e=b.get(".J_Tmsg_Panel_history");d.readyPanel(e,"\u5386\u53f2\u6d88\u606f"),j.ajax(c,{},function(c){j.deal(c,{noLogin:{code:"-1"},success:{code:"1",callback:function(c){var f=b.get(".J_Tmsg_Panel_AppsBody",e),g=c.msgList,h="";a.each(g,function(b){h+=a.substitute(k.panel.apps.apps_item_single,{appId:b.appId,messageId:b.messageId,shopClass:"",mainTitle:b.mainTitle,subTitle:b.subTitle,link:b.actionUrl,pic:b.picUrl,tips:d.renderTips(b.tips),title:d.getTitle(b.contentMsg),info:d.getInfo(b.contentMsg.info.content),actionUrl:b.actionUrl,actionName:b.contentMsg.actionName.content||""})}),b.html(f,""),b.html(f,h),d.setPanelBody(e),d.togglePanel(e)}}})})},switchHistoryMessage:function(){var a=this;j.switchGlobal({common:function(){var b=j.renderUrl(j.apis.buyerHistoryList);a.setHistoryMessage(b)},seller:function(){var b=j.renderUrl(j.apis.sellerHistoryList);a.setHistoryMessage(b)}})},ignoreSingle:function(a){var c=this,d=b.parent(a,".J_Tmsg_App"),e=b.attr(d,"data-app-id"),f=b.attr(d,"data-app-type");j.getToken(function(a){j.ajax(j.renderUrl(j.apis.ignore),{m_token:a,appId:e},function(a){j.deal(a,{noLogin:{code:"-1"},success:{code:"1",callback:function(a){b.remove(d),c.jugHoverEmpty(),c.resetLocalData(e,f)}}})})})},ignoreAll:function(a){for(var c=this,d=b.get("#J_Tmsg"),e=b.query(".J_Tmsg_App",d),f=0,g=[];f<e.length;f++)g.push(b.attr(e[f],"data-app-id"));j.getToken(function(a){j.ajax(j.renderUrl(j.apis.ignore),{m_token:a,appId:g.join(",")},function(a){j.deal(a,{noLogin:{code:"-1"},success:{code:"1",callback:function(a){var d=b.get(".J_Tmsg_Panel_AppsBody");b.html(d,""),c.jugHoverEmpty(),c.resetLocalData(g)}}})})})},deployApp:function(c){var d=this,e=b.parent(c,".J_Tmsg_Panel_Apps"),f=b.parent(c,".J_Tmsg_App"),g=b.attr(f,"data-app-id"),h=b.attr(f,"data-app-type");a.getScript(j.cdnHost+"tbc/tmsg/"+m+"/content-min.css",{success:function(){j.ajax(j.renderUrl(j.apis.message_list_for_hover),{appId:g},function(a){j.deal(a,{noLogin:{code:"-1"},success:{code:"1",callback:function(a){var c=b.get("#J_Tmsg"),i=b.get(".J_Tmsg_Panel_Detail",c);d.readyPanel(i,a.mainTitle),a.hasMoreType?d.renderDeployTypes(a):d.renderDeploysingle(a),b.remove(f),d.jugHoverEmpty(),d.setPanelBody(e),d.resetLocalData(g,h)}}})})}})},linkoutApp:function(a){var c=this,d=b.parent(a,".J_Tmsg_Panel_Apps"),e=b.parent(a,".J_Tmsg_App"),f=b.attr(e,"data-app-id"),g=b.attr(e,"data-app-type");j.getToken(function(a){j.ajax(j.renderUrl(j.apis.appReaden),{appId:f,m_token:a},function(a){j.deal(a,{noLogin:{code:"-1"},success:{code:"1",callback:function(a){b.remove(e),c.jugHoverEmpty(),c.setPanelBody(d),c.resetLocalData(f,g)}}})})})},readyPanel:function(c,d){var e=this,f=b.create(a.substitute(k.panel.apps.apps_head2,{title:d})),g=b.create(k.panel.apps.apps_body),h=b.create(k.panel.foot);b.html(c,""),b.append(f,c),b.append(g,c),b.append(h,c),e.setMessageCenterLink(c)},setPanelBody:function(c){var d=b.get(".J_Tmsg_Panel_AppsBody",c),e=(b.docHeight(),b.viewportHeight()),f=b.innerHeight(c);f+35>e&&(b.css(d,{height:f-(f-e)-35-37-32-100+"px",overflow:"auto"}),a.getScript(j.cdnHost+"tbc/tmsg/"+m+"/plugin/scroll-min.css",{success:function(){a.use("gallery/kscroll/1.2/",function(a,b){i=new b(d,{prefix:"clear-",hotkey:!0,bodydrag:!0,allowArrow:!0})})}}))},toggleStrongPanel:function(){var a=b.get("#J_Tmsg"),c=b.get(".J_Tmsg_Panel_Strong",a);b.get(".tmsg_panel_active",a)||b.show(c)},togglePanel:function(a,c){var d=this,e=b.get("#J_Tmsg"),f=b.get(".J_Menu",e),g=b.get(".menu-bd",e),h=b.get(".J_Tmsg_Panel_Detail",e),i=b.get(".J_Tmsg_Panel_history",e),j=b.get(".J_Tmsg_Panel_Setting",e);b.removeClass(h,"tmsg_panel_active"),b.removeClass(i,"tmsg_panel_active"),b.removeClass(j,"tmsg_panel_active"),b.hide(g),b.hide(h),b.hide(j),b.hide(i),d.setPanelBody(a),b.addClass(a,"tmsg_panel_active"),b.show(a),b.addClass(f,"menu-active")},jugHoverEmpty:function(){var a=this,c=b.get("#J_Tmsg"),d=b.get(".J_Tmsg_Panel_Apps",c),e=b.get(".J_Tmsg_Panel_AppsBody",d);b.get(".J_Tmsg_App",e)||a.switchNoMessageTemp()},deleteMessage:function(a){var c=this,d=b.parent(a,".J_Tmsg_App"),f=b.attr(d,"data-message-id");j.getToken(function(a){j.ajax(j.renderUrl(j.apis.deleteMessage),{messageId:f,m_token:a},function(a){a&&a.status&&("1"!=a.status&&(a.status="delErr"),j.deal(a,{noLogin:{code:"-1"},success:{code:"1",callback:function(a){var f=function(){return e.all(".J_Tmsg_App",".J_Tmsg_Panel_AppsBody").length};b.remove(d);var g=f();if(g)if(1==g)c.switchHistoryMessage();else{var h=b.viewportHeight(),j=e.all(".J_Tmsg_Panel_AppsBody.clear-body").height();h>=j+35&&(j-(j-h)-35-37-32-100>j?e.all(".J_Tmsg_Panel_history .clear-container").css({height:j+"px"}):e.all(".J_Tmsg_Panel_history .clear-scrollbar").hide()),i&&i.scrollByDistance(0)}else c.goback()}},delErr:{code:"delErr",callback:function(a){c.goback()}}}))})})},setSettingList:function(c){var d=this,e=b.get("#J_Tmsg"),f=b.get(".J_Tmsg_Panel_Setting",e),g=b.get(".J_Tmsg_Panel_AppsBody",f);j.ajax(c,{},function(c){j.deal(c,{noLogin:{code:"-1"},success:{code:"1",callback:function(c){var e=c.content,h="",i=0;if(0==e.length)b.html(g,k.panel.errors.no_message_when_setting);else if(e.length<=5&&e.length>0){for(;i<e.length;i++)h+=a.substitute(k.setting.list,{appId:e[i].appId,appName:e[i].appName,statusNum:e[i].acceptable?"1":"0",status:e[i].acceptable?"open":"close"});b.html(g,a.substitute(k.setting.wrap,{title:"\u6700\u8fd1\u63a5\u6536\u7684\u6d88\u606f",list:h}))}else if(e.length>5){for(;5>i;i++)h+=a.substitute(k.setting.list,{appId:e[i].appId,appName:e[i].appName,statusNum:e[i].acceptable?"1":"0",status:e[i].acceptable?"open":"close"});if(b.html(g,a.substitute(k.setting.wrap,{title:"\u6700\u8fd1\u63a5\u6536\u7684\u6d88\u606f",list:h})),e.length>5){for(var j=5,l="";j<e.length;j++)l+=a.substitute(k.setting.list,{appId:e[j].appId,appName:e[j].appName,statusNum:e[j].acceptable?"1":"0",status:e[j].acceptable?"open":"close"});var m=b.create(a.substitute(k.setting.wrap,{title:"\u8f83\u65e9\u63a5\u6536\u7684\u6d88\u606f",list:l}));b.append(m,g)}}d.togglePanel(f)}}})})},setSetting:function(a){var c=this,d=b.get("#J_Tmsg"),e=b.get(".J_Tmsg_Panel_Setting",d);c.readyPanel(e,"\u6d88\u606f\u8bbe\u7f6e"),j.switchGlobal({common:function(){var a=j.renderUrl(j.apis.buyerSettingList);c.setSettingList(a)},seller:function(){var a=j.renderUrl(j.apis.sellerSettingList);c.setSettingList(a)}})},setAppStatus:function(a){var c=b.parent(a,".J_Tmsg_App_Setting_Item"),d=b.attr(c,"data-app-id"),e=b.get(".tmsg_app_settilg-item_edit",c),f=b.attr(e,"data-status");j.getToken(function(a){j.ajax(j.renderUrl(j.apis.SettingSet),{appId:d,status:1==f?"0":"1",m_token:a},function(a){j.deal(a,{noLogin:{code:"-1"},success:{code:"1",callback:function(a){1==f?(b.attr(e,"data-status","0"),b.removeClass(e,"tmsg_app_settilg-item_status_open"),b.addClass(e,"tmsg_app_settilg-item_status_close")):(b.attr(e,"data-status","1"),b.removeClass(e,"tmsg_app_settilg-item_status_close"),b.addClass(e,"tmsg_app_settilg-item_status_open"))}}})})})},goback:function(){var a=b.get("#J_Tmsg"),c=b.get(".J_Menu",a),d=b.get(".menu-bd",a),e=b.get(".J_Tmsg_Panel_Detail",a),f=b.get(".J_Tmsg_Panel_history",a),g=b.get(".J_Tmsg_Panel_Setting",a);b.addClass(c,"menu-hover"),b.removeClass(e,"tmsg_panel_active"),b.removeClass(f,"tmsg_panel_active"),b.removeClass(g,"tmsg_panel_active"),b.hide(e),b.hide(f),b.hide(g),b.removeClass(c,"menu-active"),b.show(d)},showTips:function(c){b.get(".J_Tmsg_Tips_Wraps")&&b.remove(".J_Tmsg_Tips_Wraps"),a.use("overlay",function(a,d){var e=k.tips.wraps,g=b.attr(c,"data-tips"),h=b.innerWidth(c);f=new d({width:"",elCls:"J_Tmsg_Tips_Wraps",content:a.substitute(e,{tipsContent:k.tips.content[g]}),zIndex:1e10,align:{node:c,points:["tr","tl"],offset:[-h,75]}}),f.render();var i=b.get(".J_Tmsg_Tips_Wraps");b.css(i,{position:"absolute"}),f.show()})},hideTips:function(a){f.destroy&&f.destroy()},refresh:function(){var b=this,c=j.renderUrl(j.apis.unreadMessage);j.ajax(c,{},function(c){j.deal(c,{noLogin:{code:"-1"},success:{code:"1",callback:function(c){q=!0,n=a.merge(n,c.content,{newMsgTag:!1}),l.setItem("1067",n),l.notify([{t1:"1067",content:n}],!0),b.renderHoverList(n)}}})})},popupReaded:function(a){var c=b.attr(a,"data-message-id");
j.getToken(function(a){j.ajax(j.renderUrl(j.apis.popupReaden),{m_token:a,messageId:c},function(a){})})},popupClose:function(){var a=this,c=b.get("#J_Tmsg"),d=b.get(".J_Tmsg_Panel_StrongPop",c),e=b.get(".J_Tmsg_Panel_Strong_Item_Active",d);j.sendStatistic("21.5"),a.popupReaded(e),b.remove(d)},popupPrev:function(c){var d=this,e=b.parent(c,".J_Tmsg_Panel_Strong"),f=b.get(".J_Tmsg_Panel_Strong_Item_Active",e),g=b.prev(f),h=b.query(".tmsg_panel_strong_item",e);return b.attr(f,"data-message-id")==b.attr(h[h.length-1],"data-message-id")&&d.popupReaded(f),g?(a.each(h,function(a){b.removeClass(f,"J_Tmsg_Panel_Strong_Item_Active"),b.hide(a)}),b.addClass(g,"J_Tmsg_Panel_Strong_Item_Active"),b.show(g),void 0):!1},popupNext:function(c){var d=this,e=b.parent(c,".J_Tmsg_Panel_Strong"),f=b.get(".J_Tmsg_Panel_Strong_Item_Active",e),g=b.next(f),h=b.query(".tmsg_panel_strong_item",e);return g?(a.each(h,function(a){b.removeClass(f,"J_Tmsg_Panel_Strong_Item_Active"),b.hide(a)}),b.addClass(g,"J_Tmsg_Panel_Strong_Item_Active"),b.show(g),void d.popupReaded(f)):!1},showCheckAll:function(a){var c=b.parent(a,".J_Tmsg_Panel_Foot"),d=b.get(".J_Tmsg_Button_CheckAll_Wrap",c);j.switchGlobal({common:function(){n.hasSellerMsg&&b.html(d,'<a href="'+j.renderUrl("//msg.{serverHost}/message/list.htm?scm=1229.325.1.2")+'" target="_blank">\u4e70\u5bb6\u6d88\u606f</a><span style="margin:0 7px">|</span><a href="'+j.renderUrl("//msg.{serverHost}/seller/seller_list.htm?scm=1229.325.1.3")+'" target="_blank">\u5356\u5bb6\u6d88\u606f</a>')}})},bindBaseEvent:function(){var c=this,e=b.get("#J_Tmsg");p=!0,d.delegate(e,"click",".J_Tmsg_Button_CloseApp",function(a){a.preventDefault(),j.sendStatistic("21.10"),c.ignoreSingle(a.target)}),d.delegate(e,"click",".J_Tmsg_Button_ReadAll",function(a){a.preventDefault(),c.ignoreAll(a.target)}),d.delegate(e,"click",".J_Tmsg_Button_CheckPrevMsgs",function(b){b.preventDefault(),j.sendStatistic("21.9"),a.getScript(j.cdnHost+"tbc/tmsg/"+m+"/content-min.css",{success:function(){c.switchHistoryMessage()}})}),d.delegate(e,"click",".J_Tmsg_Button_DeployApp",function(a){a.preventDefault(),j.sendStatistic("21.11"),c.deployApp(a.target)}),d.delegate(e,"click",".J_Tmsg_Button_LinkoutToAPP",function(a){c.linkoutApp(a.target)}),d.delegate(e,"click",".J_Tmsg_Apps_Single-Item_Link",function(a){c.linkoutApp(a.target)}),d.delegate(e,"click",".J_Tmsg_Button_Setting",function(b){b.preventDefault(),j.sendStatistic("21.8"),a.getScript(j.cdnHost+"tbc/tmsg/"+m+"/content-min.css",{success:function(){c.setSetting(b.target)}})}),d.delegate(e,"click",".tmsg_app_settilg-item_edit",function(a){a.preventDefault(),c.setAppStatus(a.target)}),d.delegate(e,"click",".J_Tmsg_Button_GoBack",function(a){a.preventDefault(),c.goback(a.target)}),d.delegate(e,"click",".J_Tmsg_Button_Refresh",function(a){a.preventDefault(),c.refresh()}),d.delegate(e,"click",".J_Tmsg_Button_CheckAll",function(a){a.preventDefault(),c.showCheckAll(a.target)}),d.delegate(document,"click","body",function(a){var c=a.target,d=b.get(".tmsg_panel_active",e),f=!b.parent(c,".tmsg_panel_active");d&&f&&function(){var a=b.get(".J_Menu",e),c=b.get(".menu-bd",a);b.removeClass(a,"menu-active"),b.style(c,"display",""),b.hide(d)}()}),d.delegate(e,"mouseleave",".J_Menu",function(a){j.switchGlobal({seller:function(){var a=b.get("#J_Tmsg"),c=b.get(".menu-bd",a);"block"==b.css(c,"display")&&b.style(c,"display","")}})}),d.delegate(e,"mouseenter",".J_Tmsg_Panel_Strong",function(a){j.sendStatistic("21.3")}),d.delegate(e,"click",".J_Tmsg_App_Remove",function(a){a.preventDefault(),c.deleteMessage(a.target)})}},j},{requires:["dom","json","event","node"]}),KISSY.add("tbc/tmsg/3.4.6/index",function(a){var b=TMsg.cdnHost+"tbc/tmsg/3.4.6/index-min.css";TMsg.isKS16?a.getScript(b):a.getScript(b,function(){}),TMsg.base&&TMsg.base.init()},{requires:["tbc/tmsg/3.4.6/mods/const","tbc/tmsg/3.4.6/mods/utils","tbc/tmsg/3.4.6/mods/tmsg"]});